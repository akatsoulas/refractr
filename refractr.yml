headers:
  - for: /*
    values:
      Strict-Transport-Security: max-age=800
      X-Frame-Options: DENY
      X-From: Netlify
      X-XSS-Protection: 1; mode=block
refracts:
  - src:
    - firefox.com
    - www.firefox.com
    dst:
      # bug 1485429, 1432228
    - /switch: https://www.mozilla.org/en-US/firefox/
    - /mobile: https://www.mozilla.org/mobile/

    - /beta: https://www.mozilla.org/firefox/channel/

    - /aurora: https://www.mozilla.org/firefox/channel/

    - /nightly: https://nightly.mozilla.org/

    - /m: https://www.mozilla.org/m/

    - /tour: https://www.mozilla.org/firefox/central/

      # bug 870410
    - /universityambassadors: https://www.mozilla.org/contribute/universityambassadors/
    - /os: https://www.mozilla.org/firefox/os/?utm_source=firefox-com&utm_medium=referral&utm_content=firefox-os

      # bug 1004274
    - /desktop: https://www.mozilla.org/firefox/desktop/?utm_source=firefox-com&utm_medium=referral&utm_content=firefox-desktop

      # bug 1053356
    - /android: https://www.mozilla.org/firefox/android/?utm_source=firefox-com&utm_medium=referral&utm_content=firefox-android

      # bug 1091132
    - /developer: https://www.mozilla.org/firefox/developer/?utm_source=firefox-com&utm_medium=referral&utm_content=firefox-developer

      # bug 1091891
    - /10: https://www.mozilla.org/firefox/independent/?utm_source=firefox-com&utm_medium=referral&utm_content=firefox-10
    - /independant: https://www.mozilla.org/firefox/independent/?utm_source=firefox-com&utm_medium=referral&utm_content=firefox-10

      # bug 1098044
    - /hello: https://www.mozilla.org/firefox/hello/?utm_source=firefox-com&utm_medium=referral&utm_content=firefox-hello

      # bug 1159397
    - /personal: https://www.mozilla.org/firefox/personal/
    - /personal/*: https://www.mozilla.org/firefox/personal/*

      # bug 1219380
    - /choose: https://www.mozilla.org/firefox/choose/

      # bug 896570, 1427843
    - /: https://www.mozilla.org/firefox/?utm_source=firefox-com&utm_medium=referral

  # bug 537925
  # TODO: test this works as expected / previous behavior
  - src:
    - contribute.mozilla.org
    dst:
    - /index.html: http://www.mozilla.org/contribute/
    - /*: http://guides.mozilla.org/*
    - /: http://www.mozilla.org/contribute/

  # bug 1263033
  - https://donate.mozilla.org/: join.mozilla.org
    status: 307

  # bug 20170327
  - https://videos.cdn.mozilla.net/:
    - videos-cdn.mozilla.net
    - videos.mozilla.org
    - videos-ssl-cdn.mozilla.net

  # TODO: addons

  - http://www.mozillalabs.com/:
    - labs.mozilla.org
    - labs.mozilla.com

  # bug 503731, 528747, 537144
  - https://addons.mozilla.org/:
    - extensions.mozilla.org
    - themes.mozilla.org
    - update.mozilla.org
    - updates.mozilla.org
    - addons.update.mozilla.org
    - firefoxaddons.com
    - www.firefoxaddons.com

  - http://www.mozilla.org/projects/calendar/lightning/:
    - lightning-project.org
    - www.lightning-project.org

  # bug 510914
  - http://wiki.mozilla.org/: library.mozilla.org

  # bug 572191
  - http://crash-stats.mozilla.com/: #FIXME: http? really?
    - talkback.mozilla.org
    - talkback-public.mozilla.org
    - talkback-reports.mozilla.org

  - https://blog.mozilla.org/blog/2010/07/15/thanks-for-an-exciting-firefox-cup/:
    - firefoxcup.com
    - www.firefoxcup.com
    - www.firefoxcup2010.com
    - firefoxcup2010.com

  # bug 613649
  - https://krakenbenchmark.mozilla.org/: krakenbenchmark.mozilla.com

  # bug 614684
  - https://blog.mozilla.org/blog/2008/12/22/congratulations-fox-for-all-wins-impact-mozilla/:
    - impactmozilla.com
    - www.impactmozilla.com

  # bug 681943
  - https://mozillafestival.org/: festival.mozilla.org

  # bug 1490779
  - https://aus4.mozilla.org/: aus2.mozilla.org

  # bug 692904
  - https://www.mozilla-russia.org/:
    - mozilla.com.ru
    - www.mozilla.com.ru

  # bug 722504
  - https://wiki.mozilla.org/Security/Events/CTF:
    - mozillactf.org
    - www.mozillactf.org

  # bug 695084
  - https://developer.mozilla.org/: dev.mozilla.org

  # bug 749836
  - https://www.mozilla.org/firefox/new/?utm_source=firefox-pt&utm_medium=referral:
    - firefox.pt
    - www.firefox.pt

  # bug 784556, 880423
  - https://mana.mozilla.org/wiki/display/SD/print.mozilla.com: print.mozilla.com

  # bug 804895
  - https://wiki.mozilla.org/Platform/AreWeFunYet:
    - arewefunyet.com
    - www.arewefunyet.com

  # bug 811323
  # TODO: switch all HTTP sources to use HTTP and HTTPS, currently tests won't pass that way but once they are on Netlify they will
  - https://developer.mozilla.org/demos/devderby: devderby.mozilla.org

  # bug 855746
  # TODO: figure out why this won't pass tests.  It works for me in curl
  - https://mozilla.ec/:
    - mozillaecuador.org
    - www.mozillaecuador.org

  # bug 908234
  - https://blog.mozilla.org/webdev/: webdev.mozilla.org

  - https://www.mozilla.org/MPL/: mpl.mozilla.org

  # bug 941881
  - http://www.mozilla.org/en-US/contribute/studentambassadors/:
    - ambassadors.mozilla.org
    - students.mozilla.org
    - fsa.mozilla.org

  # bug 971390
  - https://www.mozilla.org/ru/firefox/new/:
    - firefoxik.ru
    - www.firefoxik.ru

  # bug 998526, 20170328
  - https://docs.google.com/forms/d/1VSlo6TZ5p42LyTx2q7Wd5vQ5hZHvWtA9JN6JWicXmBM/viewform: confsurvey.mozilla.org

  # bug 850584
  - http://download.cdn.mozilla.net/: releases.mozilla.org

  # bug 1025191
  - https://www.mozilla.org/en-US/:
    - mozilla.ca
    - www.mozilla.ca

  # bug 1035550
  - https://wiki.mozilla.org/: wiki.mozilla.com

  # bug 1136318
  - http://www.mozilla.de/: #FIXME: http? really?
    - mozilla.at
    - www.mozilla.at

  # bug 1203755
  - https://wiki.mozilla.org/B2G:
    - boot2gecko.org
    - www.boot2gecko.org
    status: 307

  # bug 1056359
  - https://www.mozilla.org/en-US/firefox/new/:
    - mozilla.it
    - wwww.mozilla.it

  # bug 1212631, 1427843
  # FIXME: removed escape for &
  - https://www.mozilla.org/firefox/new/?utm_source=getfirefox-co-uk&utm_medium=referral: getfirefox.co.uk


  # bug 1212612, 1212612
  - https://www.mozilla.org/firefox/new/?utm_source=getfirefox-de&utm_medium=referral:
    - getfirefox.de
    - www.getfirefox.de
    - firefox-hacks.de
    - www.firefox-hacks.de
    - firefox2.de
    - www.firefox2.de

  # bug 1214568
  - https://blog.mozilla.org/creative: creative.mozilla.org

  # bug 1220879
  - https://whatsdeployed.io/: whatsdeployed.paas.allizom.org #FIXME: note I swtiched to https as the final destination

  # bug 1220879
  - http://prs.mozilla.io/: prs.paas.allizom.org

  # bug 1225273, 1359534
  - https://docs.taskcluster.net/: taskcluster.net

  # bug 1212612, 1427843
  - https://www.mozilla.org/firefox/new/?utm_source=getfirefox-net&utm_medium=referral:
    - getfirefox.net
    - www.getfirefox.net

  # bug 1195576
  - https://mozillafoundation.org:
    - mozillafoundation.com
    - mozillafoundation.net

  # bug 1243236
  - https://careers.mozilla.org/:
    - jobs.mozilla.org
    - jobs.mozilla.com

  # bug 1243355
  - https://www.mozilla.org/fy-NL/:
    - mozilla.frl
    - www.mozilla.frl

  # bug 1234248
  - http://planet.firefox.com/ux/: ux.firefox.com

  # bug 1255190
  - https://www.openwebgames.com/: openwebgames.com

  # bug 1259820
  - https://air.mozilla.org/: air.mozilla.com

  # bug 1268570, 1427843
  - https://www.mozilla.org/firefox/new/?utm_source=firefox-lt&utm_medium=referral:
    - firefox.lt
    - www.firefox.lt

  # bug 1290923
  - https://disconnect.me/trackerprotection:
    - trackingprotection.info
    - www.trackingprotection.info

  # bug 1262196, 1427843
  - https://www.mozilla.org/firefox/new/?utm_source=firefox-hu&utm_medium=referral:
    - firefox.hu
    - www.firefox.hu

  # bug 1311392
  - https://www.mozilla.org/pl/firefox/new/:
    - mozillafirefox.pl
    - www.mozillafirefox.pl

  # bug 1334200
  - https://github.com/mozilla/popcorn-js/:
    - popcornjs.org
    - www.popcornjs.org

  # bug 1342698
  - http://blog.mozilla.org/: mozillausa.org

  # bug 838939
  - https://www.mozilla.org/firefox/: downloadmozillafirefox.com

  # bug 838939
  - https://www.mozilla.org/firefox/: spark.mozilla.org

  - https://mozilla.org/:
    - redirect-san.mozilla.org
    status: 307

  - http://mozilla.org/: redirects-http-only.external.zlb.scl3.mozilla.com
    status: 307

  # bug 688019, 1427843
  - https://www.mozilla.org/firefox/new/?utm_source=getfirefox-org&utm_medium=referral:
    - getfirefox.org
    - www.getfirefox.org

  # virtual-redirect-autogen.conf merged into virtual-redirect
  # this used to be generated by a script somehow, but not now.
  # that script was dnsconfig/bin/generate-virtual-redirects.sh
  - https://www.mozilla.org/:
    - mozillaservice.net
    - www.mozillaservice.net
    - firefox4all.com
    - www.firefox4all.com
    - firefoxsoftware.com
    - www.firefoxsoftware.com
    - update-firefox.com
    - www.update-firefox.com
    - extendfirefox.com
    - www.extendfirefox.com
    - onemozilla.org
    - www.onemozilla.org
    # bug 1234360
    - firefoxflicks.mozilla.org
    # bug 126196
    - mozilla.hu
    - www.mozilla.hu
    # bug 1331870
    - events.mozspaces.org
    # Bug 710695 708705
    - firefoxflicks.com
    - firefoxflicks.org
    - www.firefoxflicks.com
    - www.firefoxflicks.org
    # fashionyourfirefox.com - Modified as per Bug 614412
    - fashionyourfirefox.com
    - www.fashionyourfirefox.com
    # We're not using website-beta right now.
    - website-beta.mozilla.org
    # split out store.mozilla.org|com as per bug 1142629
    # modified for bug 1260869 now that gear.mozilla.org has gone away
    - www.store.mozilla.org
    - store.mozilla.org
    - store.mozilla.com
    # Bug 619759
    - www.mozilla.net
    # bug 870904
    - mozsecworld.org
    - www.mozsecworld.org
    # bug 841514
    - detodosparatodos.org
    - www.detodosparatodos.org
    - detodosparatodos.com
    - www.detodosparatodos.com
    # bug 1268570
    - firefox-downloaden.de
    # bug 830904
    - communitystore.mozilla.org
    # TODO: can we decom this?
    # bug 1234360
    - mobilepartners.mozilla.org
    # bug 1329125
    - masterfirefoxos.mozilla.org

  - https://marketplace.firefox.com/: apps.mozillalabs.com

  # bug 1427843
  - https://www.mozilla.org/firefox/new/?utm_source=firefox-be&utm_medium=referral:
    - firefox.be
    - www.firefox.be

  # bug 713065
  - https://wiki.mozilla.org/MarketingGuide: guides.mozilla.org

  # bug 998357
  - https://activations.cdn.mozilla.net/:
    - activations.mozilla.com
    - activations.mozilla.org

  # bug 1274647
  - https://discourse.mozilla-community.org/c/firefox-development/: ask.mozilla.org

  # bug 1351245
  - 'https://www.mozilla.org/firefox/channel/desktop/#developer': aurora.mozilla.org

  # bug 656457
  - 'https://www.mozilla.org/firefox/channel/#beta': beta.mozilla.org

  # bug 1246674
  - https://careers.mozilla.org/: careers.mozilla.com

  # bug 1119912, 1165757, 1213900, 1200359
  # TODO: verify this works as expected / previously
  - src: content.mozilla.org
    dst:
    - /dmexco: https://www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team
    - /*: https://www.mozilla.org/about/partnerships/contentservices/:splat/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team
    - /: https://www.mozilla.org/about/partnerships/contentservices/?utm_source=content-moz-org&utm_medium=referral&utm_content=content_team

  # bug 756358
  # TODO: verify this works as expected
  - src: dnt.mozilla.org
    dst:
    - /dnt-enabler.tpl: http://www.mozilla.org/media/dnt/dnt-enabler.tpl
    - /: https://www.mozilla.org/firefox/dnt/

  # bug 1185027
  - https://www.contributejson.org/: contributejson.org

  # bug 1335596
  - https://mozilla.ninja/: designlanguage.mozilla.org

  # bug 1200302
  - https://discourse.mozilla.org/c/add-ons: forums.mozilla.org

  # bug 1255221
  - https://www.mozilla.org/contribute/friends: friends.mozilla.org

  # bug 896570, 1427843, 1485429, 1297860
  - https://www.mozilla.org/firefox/new/?redirect_source=getfirefox-com:
    - getfirefox.com
    - www.getfirefox.com

  # bug 896570
  - https://www.mozilla.org/firefox/?redirect_source=getfirefox-com:
    - mozillafirefox.com
    - www.mozillafirefox.com
    - firefoxbrowser.com
    - www.firefoxbrowser.com
    - firefoxbrowser.org
    - www.firefoxbrowser.org

  # bug 1290260
  - https://wiki.mozilla.org/DeveloperServices/HistoricalVCS: git.mozilla.org

  # bug 1315316
  - https://qsurvey.mozilla.com/s3/FirefoxInput/:
    - input.mozilla.org
    - input.mozilla.com

  - https://qsurvey.mozilla.com/s3/FirefoxInput/:
    - m.input.mozilla.org
    - m.input.mozilla.com
    - feedback.mozilla.org

  # bug 1150296
  - https://irccloud.mozilla.com/: irccloud.mozilla.org
    status: 302

  # bug 1335617
  - https://www.mozilla.org/en-US/about/policy/lean-data/:
    - leandatapractices.org
    - www.leandatapractices.org
    - leandatapractices.com
    - www.leandatapractices.com

  # TODO: figure out if phish-error.mozilla.com belongs here or with the wildcard *.phish-error.mozilla.com site
  # TODO: figure out if phish-report.mozilla.com belongs here or with the wildcard *.phish-report.mozilla.com site
  # TODO: figure out if malware-error.mozilla.com belongs here or with the wildcard *.malware-error.mozilla.com site

  # bug 1306375
  - https://wiki.mozilla.org/TestEngineering/Testrail: moztrap.mozilla.org

  # bug 1301642, 1326390
  - 'https://www.mozilla.org/firefox/channel/#nightly': nightly.mozilla.org

  # bug 985510
  - https://pontoon.mozilla.org/: pontoon.mozillalabs.com

  # bug 1311146
  - https://donate.mozilla.org/: sendto.mozilla.org
    status: 307

  # bug 1206287
  - https://www.srihash.org/: srihash.org

  # bug 499384
  - http://affiliates.mozilla.org/:
    - firefoxparty.com
    - www.firefoxparty.com
    - mozillaparty.com
    - www.mozillaparty.com

  # bug 1340330
  - https://www.metricsgraphicsjs.org/: metricsgraphicsjs.org

  # bug 1320683
  - https://www.arewestableyet.com/: arewestableyet.com

  # bug 1361114
  - https://www.mozilla.org/: webwewant.mozilla.org

  - https://www.mozilla.org/: mozilla-podcasts.org

  # bug 1366849
  - https://www.mozilla.org/en-US/projects/calendar/: calendar.mozilla.org

  # bug 1384357
  - https://www.extensiontest.com/: extensiontest.com

  # bug 1396954
  - https://research.mozilla.org/mixed-reality: mixedreality.mozilla.org

  # TODO: make sure this works as expected
  - https://mana.mozilla.org/wiki/display/NAGIOS/*:
    - m.mozilla.org/*
    - m.allizom.org/*
    status: 307

  # bug 1414285, 1429854
  - https://onlinexperiences.com/scripts/Server.nxp?LASCmd=L:0&AI=1&InitialDisplay=1&ClientBrowser=0&ShowKey=44908: airmo.mozilla.org

  # bug 1415362
  - https://www.mozilla.org/firefox/?utm_medium=referral&utm_source=firefoxquantum-com: firefoxquantum.com

  # bug 1421587
  - https://medium.com/mozilla-open-innovation: open.mozilla.org

  # bug 1441865
  - https://mozilla-releng.net/treestatus: treestatus.mozilla.org

  # bug 1330438
  - https://moz-releng-docs.readthedocs.io/en/latest/: docs.pub.build.mozilla.org

  # bug 1459170
  - https://perf-html.io/: cleopatra.io

  # bug 1461516
  - https://www.mozilla.org/: smartdogz.org

  # bug 1169224, 1473015
  - https://www.mozilla.org/:
    - mozilla.org.uk
    - www.mozilla.org.uk

  # bug 1485991
  - https://onlinexperiences.com/scripts/Server.nxp?LASCmd=L:0&AI=1&InitialDisplay=1&ClientBrowser=0&ShowKey=44908: air.mozilla.org

  # bug 1419948
  # TODO: verify this works as before
  - https://web.archive.org/web/20180106223649/https://webfwd.org/:
    - webfwd.org
    - www.webfwd.org
    - webfwd.net
    - www.webfwd.net

  # bug 1462137
  - https://hubs.mozilla.com/:
    - hub.mozilla.com
    - hub.mozilla.org

  # bug 1293353
  - https://mozilla.service-now.com/: thehub.mozilla.com

  # TODO: figure out if start.mozilla.com and start-prod.mozilla.com belong here or with *.start*.mozilla.com sites
  # bug 1492531
  - https://wiki.mozilla.org/Pastebin: pastebin.mozilla.org

  # bug 1492428
  - https://www.mozilla.org/en-GB/firefox/new/?utm_source=mozilla-eu&utm_medium=referral:
    - mozilla.eu
    - www.mozilla.eu
    - mozila.eu
    - www.mozila.eu

    # bug 1492428
  - https://www.mozilla.org/fr/firefox/new/?utm_source=mozilla-fr&utm_medium=referral:
    - mozilla.fr
    - www.mozilla.fr

  # bug 1463086
  - https://mozilla.org/nl/:
    - mozilla.nl
    - www.mozilla.nl

  # bug 1502902
  - https://events.mozilla.org/techspeakers/: techspeakers.mozilla.org

    # bug 1522224
  - https://testpilot.firefox.com/: contribute.testpilot.firefox.com

    # bug 1533035
  - https://mozilla.github.io/geckoview/: geckoview.dev

  - https://mozilla.github.io/geckoview/: gv.dev

  - https://developer.mozilla.org/: developer.mozilla.com

    # bug 1543423
  - https://discourse.mozilla.org/: discourse.mozilla-community.org
    status: 307

  - https://www.mozilla.org/: triagebot.mozilla.org

  # TODO: test this works as before
  # bug 1304806
  - https://phonebook.mozilla.org/: phonebook.mozilla.com
  # bug 1566155
  - src: phonebook.mozilla.org
    dst:
    - /tree.php: https://people.mozilla.org/o
    - /*: https://people.mozilla.org/s?query=:*&who=staff
    - /: https://people.mozilla.org/

  - https://pad.mozilla.org/: public.etherpad-mozilla.org

  # bug 1581429
  - https://support.mozilla.org/en-US/kb/canary-domain-use-application-dnsnet/: use-application-dns.net

  # bug 1538932
  - https://mozilla.report/: reports.telemetry.mozilla.org

  # bug 1587941
  # TODO: test this works as before
  - src: lockwise.firefox.com
    dst:
    - /faq.html: https://support.mozilla.org/products/firefox-lockwise/
    - /addon/updates.json: https://mozilla-lockwise.github.io/addon/updates.json
    - /: https://www.mozilla.org/firefox/lockwise/

  - https://www.mozilla.org/firefox/lockwise/: lockbox.firefox.com

    # bug 1440375
  - https://www.mozilla.org/pt-BR/: mozilla.com.br

    # bug 1536288
  - https://www.mozilla.org/pt-BR/: firefox-bug-handling.mozilla.org

  # Test domains
  - https://www.mozilla.org/:
    - mozilla-redirects.xyz
    - refractr.allizom.org

  # Bug 149411
  - http://start.mozilla.org/:
    - start.mozilla.com
    - start-prod.mozilla.com
  - src:
    - wildcard.start.mozilla.com
    - '*.start.mozilla.com'
    - '*.start2.mozilla.com'
    - '*.start3.mozilla.com'
    - '*.start-prod.mozilla.com'
    dst:
      - if: '$http_host ~ "^(?<lang>[a-z]{2,3}(-[a-z]{2})?)?\.(start.*)$"'
        ^: http://start.mozilla.org/$lang$request_uri
    tests:
      http://ca.start.mozilla.com: http://start.mozilla.org/ca/
      http://en-us.start.mozilla.com: http://start.mozilla.org/en-us/
      http://en-uk.start.mozilla.com: http://start.mozilla.org/en-uk/
