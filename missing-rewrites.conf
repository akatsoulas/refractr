# modeled after the virtual-redirect-autogen condensed form
<VirtualHost *:80>
    ServerName virtual-redirect-firefox

    # bug 838939
    ServerAlias downloadmozillafirefox.com
    # bug 948963
    ServerAlias spark.mozilla.org

    # default redirect caching duration
    Header always set Cache-Control "max-age=600"

    RewriteEngine On
    RewriteRule . https://www.mozilla.org/firefox/ [R=302,L]
</VirtualHost>

# virtual-redirect-autogen.conf merged into virtual-redirect
# this used to be generated by a script somehow, but not now.
# that script was dnsconfig/bin/generate-virtual-redirects.sh

<VirtualHost *:80>
    ServerName virtual-redirect-mozilla.org
    ServerAlias virtual-redirect-mozilla.com

    ServerAlias mozillaservice.net www.mozillaservice.net
    ServerAlias firefox4all.com www.firefox4all.com
    ServerAlias firefoxsoftware.com www.firefoxsoftware.com
    ServerAlias update-firefox.com www.update-firefox.com
    ServerAlias extendfirefox.com www.extendfirefox.com
    ServerAlias onemozilla.org www.onemozilla.org
    # bug 1234360
    ServerAlias firefoxflicks.mozilla.org
    # bug 126196
    ServerAlias mozilla.hu www.mozilla.hu
    # bug 1331870
    ServerAlias events.mozspaces.org
    # Bug 710695 708705
    ServerAlias firefoxflicks.com firefoxflicks.org www.firefoxflicks.com www.firefoxflicks.org
    # fashionyourfirefox.com - Modified as per Bug 614412
    ServerAlias fashionyourfirefox.com www.fashionyourfirefox.com
    # We're not using website-beta right now.
    ServerAlias website-beta.mozilla.org
    # split out store.mozilla.org|com as per bug 1142629
    # modified for bug 1260869 now that gear.mozilla.org has gone away
    ServerAlias www.store.mozilla.org store.mozilla.org store.mozilla.com
    # Bug 619759
    ServerAlias www.mozilla.net
    # bug 870904
    ServerAlias mozsecworld.org www.mozsecworld.org
    # bug 841514
    ServerAlias detodosparatodos.org www.detodosparatodos.org detodosparatodos.com www.detodosparatodos.com
    # bug 1268570
    ServerAlias firefox-downloaden.de
    # bug 830904
    ServerAlias communitystore.mozilla.org
    # TODO: can we decom this?
    # bug 1234360
    ServerAlias mobilepartners.mozilla.org
    # bug 1329125
    ServerAlias masterfirefoxos.mozilla.org

    # default redirect caching duration
    Header always set Cache-Control "max-age=600"

    RewriteEngine On
    RewriteRule . https://www.mozilla.org/ [R=302,L]
</VirtualHost>

# This virtual host redirects requests made by the live bookmark in Firefox's
# default personal toolbar, the purpose of which is to demonstrate the feature.
<VirtualHost *:80>
    ServerName fxfeeds.mozilla.org
    ServerAlias fxfeeds.mozillazine.org
    ServerAlias fxfeeds.mozilla.com
    ServerAlias *.fxfeeds.mozilla.com

    # 302's still set Content-Type: text/html, according to curl
    ExpiresActive on
    ExpiresByType text/html "access plus 1 week"
    Header set Cache-Control "max-age=604800"

    RewriteEngine On

    # catch old clients on Japanese FF 1.5 and older
    RewriteCond %{HTTP_HOST} =^fxfeeds\.mozilla-japan\.org$
    RewriteRule ^/rss20\.xml$ /ja/firefox/headlines.xml

    RewriteRule ^/af/firefox/headlines.xml http://www.news24.com/News24v2/Components/Generic/news24RSSFeed/0,,3,00.xml [R]
    RewriteRule ^/as/firefox/headlines.xml http://www.bbc.co.uk/hindi/index.xml [R]
    RewriteRule ^/ast/firefox/headlines.xml http://www.europapress.es/rss/rss.aspx?ch=395 [R]
    RewriteRule ^/bg/firefox/headlines.xml http://dnevnik.bg/rss/ [R]
    RewriteRule ^/be/firefox/headlines.xml http://nn.by/rss.php [R]
    RewriteRule ^/bn-BD/firefox/headlines.xml http://rss.bdnews24.com/rss/bangla/home/rss.xml [R]
    RewriteRule ^/bn-IN/firefox/headlines.xml http://www.telegraphindia.com/feeds/rss.jsp?id=3 [R]
    RewriteRule ^/br/firefox/headlines.xml http://www.agencebretagnepresse.com/rss-all.php [R]
    RewriteRule ^/bs/firefox/headlines.xml http://www.mojportal.ba/rssfeed/7 [R]
    RewriteRule ^/ca/firefox/headlines.xml http://www.vilaweb.cat/media/rss/noticies_edicio_333_rss.xml [R]
    RewriteRule ^/cs/firefox/headlines.xml http://firefox-rss.ceskenoviny.cz/ [R]
    RewriteRule ^/csb/firefox/headlines.xml http://www.gazeta.pl/pub/rss/wiadomosci.xml [R]
    RewriteRule ^/cy/firefox/headlines.xml http://newsrss.bbc.co.uk/rss/welsh/newyddion/rss.xml [R]
    RewriteRule ^/da/firefox/headlines.xml http://www.dr.dk/Forms/Published/rssNewsFeed.aspx?config=4cdd8bff-48a5-461c-a848-f553db411d4c&rss=Yes&rssTitle=DR+Nyheder+Online+-+Alle+nyheder&overskrift=Alle+nyheder+-+24+timer&Url=\%2fnyheder\%2f&escaping=Yes [R,NE]
    RewriteRule ^/de/firefox/headlines.xml http://www.tagesschau.de/xml/rss2 [R]
    RewriteRule ^/el/firefox/headlines.xml http://news.google.gr/nwshp?hl=el&tab=wn&output=rss [R]
    RewriteRule ^/en-GB/firefox/headlines.xml http://news.bbc.co.uk/rss/newsonline_uk_edition/front_page/rss.xml [R]
    RewriteRule ^/eo/firefox/headlines.xml http://www.liberafolio.org/search_rss?SearchableText=&Title=&Description=&portal_type:list=News+Item&portal_type:list=Link&portal_type:list=Document&Creator=redakcio&submit=Search&sort_on=created&sort_order=reverse&review_state=published&sort_limit:int=20 [R]
    RewriteRule ^/es-AR/firefox/headlines.xml http://www.clarin.com/diario/hoy/um/sumariorss.xml [R]
    RewriteRule ^/es-CL/firefox/headlines.xml http://latercera.com/app/rss?sc=TEFURVJDRVJB&ul=1 [R]
    RewriteRule ^/es-ES/firefox/headlines.xml http://www.20minutos.es/rss/ [R]
    RewriteRule ^/es-MX/firefox/headlines.xml http://www.eluniversal.com.mx/rss/universalmxm.xml [R]

    RewriteRule ^/et/firefox/headlines.xml http://www.postimees.ee/rss/ [R]
    RewriteRule ^/eu/firefox/headlines.xml http://www.berria.info/rss/berria.php [R]
    RewriteRule ^/fa/firefox/headlines.xml http://news.parseek.com/rss/ [R]
    RewriteRule ^/fi/firefox/headlines.xml http://www.yle.fi/uutiset/rss/paauutiset.xml [R]
    RewriteRule ^/fr/firefox/headlines.xml http://www.lemonde.fr/rss/sequence/0,2-3208,1-0,0.xml?nav=firefox [R]
    RewriteRule ^/fy-NL/firefox/headlines.xml http://www.omropfryslan.nl/rss [R]
    RewriteRule ^/ga-IE/firefox/headlines.xml http://gaelport.com/rss.php [R]
    RewriteRule ^/gd/firefox/headlines.xml http://www.bbc.co.uk/scotland/alba/naidheachdan/index.xml [R]
    RewriteRule ^/gl/firefox/headlines.xml http://chuza.org/rss2.php [R]
    RewriteRule ^/he/firefox/headlines.xml http://www.ynet.co.il/Integration/StoryRss2.xml [R]
    RewriteRule ^/hi-IN/firefox/headlines.xml http://www.bbc.co.uk/hindi/index.xml [R]
    RewriteRule ^/hu/firefox/headlines.xml http://24ora.index.hu/?rss&keres=&szerzokeres=&rovatkeres=osszes&order=1 [R]
    RewriteRule ^/hy-AM/firefox/headlines.xml http://news.am/arm/rss/ [R]
    RewriteRule ^/id/firefox/headlines.xml http://sindikasi.okezone.com/index.php/news/RSS2.0 [R]
    RewriteRule ^/is/firefox/headlines.xml http://www.mbl.is/mm/rss/forsida.xml [R]
    RewriteRule ^/it/firefox/headlines.xml http://static.adnkronos.com/rss/RSS_FireFox.xml [R]
    RewriteRule ^/ja/firefox/headlines.xml http://mainichi.jp/rss/etc/mainichi.rss [R]
    RewriteRule ^/kk/firefox/headlines.xml http://www.azattyq.org/rss/ [R]
    RewriteRule ^/kn/firefox/headlines.xml http://sampada.net/node/feed [R]
    RewriteRule ^/ko/firefox/headlines.xml http://news.google.co.kr/?output=rss [R]
    RewriteRule ^/lt/firefox/headlines.xml http://www.lrt.lt/rss/all.php [R]
    RewriteRule ^/lv/firefox/headlines.xml http://www.delfi.lv/rss.php [R]
    RewriteRule ^/ml/firefox/headlines.xml http://mangalam.com/rss/rssm.php [R]
    RewriteRule ^/mk/firefox/headlines.xml http://www.makdenes.org/rss/ [R]
    RewriteRule ^/mr/firefox/headlines.xml http://www.bbc.co.uk/hindi/index.xml [R]
    RewriteRule ^/nb-NO/firefox/headlines.xml http://www.nrk.no/nyheiter/toppsaker.rss [R]
    RewriteRule ^/nl/firefox/headlines.xml http://feeds.nos.nl/nosnieuws [R]
    RewriteRule ^/nn-NO/firefox/headlines.xml http://www.nrk.no/nyheiter/toppsaker.rss [R]
    RewriteRule ^/oc/firefox/headlines.xml http://www.ostaldoccitania.net/data/newsoc.xml [R]
    RewriteRule ^/or/firefox/headlines.xml http://newsrss.bbc.co.uk/rss/newsonline_world_edition/south_asia/rss.xml [R]
    RewriteRule ^/pl/firefox/headlines.xml http://www.gazeta.pl/pub/rss/wiadomosci.xml [R]
    RewriteRule ^/pt-BR/firefox/headlines.xml http://www.estadao.com.br/rss/ultimas.xml?source=fx [R]
    RewriteRule ^/pt-PT/firefox/headlines.xml http://www.destakes.com/ultimas/?cat=newspaper&format=rss [R]
    RewriteRule ^/rm/firefox/headlines.xml http://www.rtr.ch/categoriesFeed/d5e1ee01-34db-4f20-953b-f3781243bf8d,b7192a1e-7f70-4441-9fbe-d8c50a4d9ffe,0b6aafe7-505b-4ba1-af67-b2fd0cb7c801,2de65430-024f-43fc-8b5c-8135ce6dd7c4,83545462-f436-4074-838c-9047b47d5cd9 [R]
    RewriteRule ^/ro/firefox/headlines.xml http://www.bbc.co.uk/romanian/index.xml [R]
    RewriteRule ^/ru/firefox/headlines.xml http://news.rambler.ru/rss/head/ [R]
    RewriteRule ^/si/firefox/headlines.xml http://blogs.sinhalabloggers.com/feed/ [R]
    RewriteRule ^/sk/firefox/headlines.xml http://rss.sme.sk/rss/rss.asp?sek=smeonline&id=frontpage [R]
    RewriteRule ^/sl/firefox/headlines.xml http://rss.24ur.com/index.rss [R]
    RewriteRule ^/sq/firefox/headlines.xml http://www.bbc.co.uk/albanian/index.xml [R]
    RewriteRule ^/sr/firefox/headlines.xml http://www.naslovi.net/rss/ [R]
    RewriteRule ^/sv-SE/firefox/headlines.xml http://api.sr.se/api/rssfeed/rssfeed.aspx?rssfeed=83 [R]
    RewriteRule ^/ta/firefox/headlines.xml http://www.bbc.co.uk/tamil/index.xml [R]
    RewriteRule ^/ta-LK/firefox/headlines.xml http://www.bbc.co.uk/tamil/index.xml [R]
    RewriteRule ^/te/firefox/headlines.xml http://in.telugu.yahoo.com/rss/news.xml [R]
    RewriteRule ^/th/firefox/headlines.xml http://newsrss.bbc.co.uk/rss/newsonline_world_edition/asia-pacific/rss.xml [R]
    RewriteRule ^/tr/firefox/headlines.xml http://www.ntvmsnbc.com/id/3032091/device/rss/rss.xml [R]
    RewriteRule ^/uk/firefox/headlines.xml http://www.bbc.co.uk/ukrainian/index.xml [R]
    RewriteRule ^/vi/firefox/headlines.xml http://vietnamnet.vn/rss/index.rss [R]
    RewriteRule ^/zh-TW/firefox/headlines.xml http://web.pts.org.tw/php2/rss/xml/ptsnews.xml [R]
    RewriteRule ^/zh-CN/firefox/headlines.xml http://rss.sina.com.cn/news/marquee/ddt.xml [R]

    RewriteRule ^/(\w{2,3}(-\w{2,3}(-mac)?)?)/(.*) http://fxfeeds.mozilla.com/$4 [R]
    RewriteRule ^/(firefox/)?livebookmarks(.*)$ http://www.mozilla.org/firefox/livebookmarks.html [R]

    Redirect temp /rss20.xml http://newsrss.bbc.co.uk/rss/newsonline_world_edition/front_page/rss.xml
    Redirect temp /firefox/headlines.xml http://newsrss.bbc.co.uk/rss/newsonline_world_edition/front_page/rss.xml
    Redirect temp / http://www.mozilla.org/firefox/livebookmarks.html

    # Don't log in three different ways: redirect log output to /dev/null,
    # log only the empty string, and log only if the "nonexistent" environment
    # variable exists (which it doesn't).  It'd be nice to just say "don't log",
    # but Apache apparently doesn't have that capability.  Duh.
    CustomLog /dev/null " " env=nonexistent

    # Do log errors, since those could be interesting to know about.
    ErrorLog logs/fxfeeds-error_log
</VirtualHost>

#####################################################################
# phish-error.mozilla.com
<VirtualHost *:80>
    ServerName phish-error.mozilla.com
    ServerAlias *.phish-error.mozilla.com

    # default redirect caching duration
    Header always set Cache-Control "max-age=600"

    RewriteEngine On
    RewriteRule "^/?(.*)" "https://%{HTTP_HOST}/$1" [L,R=307,QSA]
</VirtualHost>
<VirtualHost *:81>
    ServerName https://phish-error.mozilla.com
    ServerAlias *.phish-error.mozilla.com

    # default redirect caching duration
    Header always set Cache-Control "max-age=600"

    RewriteEngine On

    # Bug 1387246, send language and url query strings to google safebrowsing
    RewriteCond %{QUERY_STRING} hl=([^&]+)&url=([^&]+)
    RewriteRule ^/$ https://safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&hl=%1&url=%2 [L,R,NE]

    # Bug 1387246, send lone url query strings to google safebrowsing
    RewriteCond %{QUERY_STRING} url=([^&]+)
    RewriteRule ^/$ https://safebrowsing.google.com/safebrowsing/report_error/?tpl=mozilla&url=%1 [L,R,NE]

    RewriteRule ^/.*$ https://www.mozilla.org/ [R]

</VirtualHost>

#####################################################################
# malware-error.mozilla.com
<VirtualHost *:80>
    ServerName malware-error.mozilla.com
    ServerAlias *.malware-error.mozilla.com

    RewriteEngine On
    RewriteRule "^/?(.*)" "https://%{HTTP_HOST}/$1" [L,R=307,QSA]
</VirtualHost>
<VirtualHost *:81>
    ServerName https://malware-error.mozilla.com
    ServerAlias *.malware-error.mozilla.com

    # default redirect caching duration
    Header always set Cache-Control "max-age=600"

    RewriteEngine On

    # Bug 1387246, send language and/or url query strings to google safebrowsing
    RewriteCond %{QUERY_STRING} hl=([^&]+)&url=([^&]+)
    RewriteRule "^/$" "https://www.stopbadware.org/firefox?hl=%1&url=%2" [L,R=307]

    RewriteCond %{QUERY_STRING} url=([^&]+)
    RewriteRule "^/$" "https://www.stopbadware.org/firefox?url=%1" [L,R=307]

    RewriteRule ^/.*$ https://www.mozilla.org/ [R]

</VirtualHost>

# bug 1304806
<VirtualHost *:80>
    ServerName phonebook.mozilla.com

    # default redirect caching duration
    Header always set Cache-Control "max-age=600"

    RewriteEngine On
    RewriteRule "^/?(.*)" "https://%{HTTP_HOST}/$1" [L,R=307,QSA]
</VirtualHost>
<VirtualHost *:81>
    ServerName https://phonebook.mozilla.com

    # default redirect caching duration
    Header always set Cache-Control "max-age=600"

    Redirect 302 / https://phonebook.mozilla.org/

    ## SSL-specific security headers requested by websec [#1261870]
    # these are set *before* SSO, as they affect only our specific SSL site

    # HSTS enforcement, 2 year duration.
    Header always set Strict-Transport-Security "max-age=63072000"

    # HPKP certificate pinning headers, with escaped \" double quotes [#1304799]
    # 3600 seconds only for initial testing -- 20160922 atoll
    Header always set Public-Key-Pins "max-age=3600; pin-sha256=\"zSvnhQdjmYpQNahZ5voq6EGaNgaT0ElRiy+mzBD7p+k=\"; pin-sha256=\"5kJvNEMw0KjrCAu7eXY5HZdvyCS13BbA0VJG1RSP91w=\"; pin-sha256=\"YLh1dUR9y6Kja30RrAn7JKnbQG/uEtLMkBgFF2Fuihg=\"; pin-sha256=\"sRHdihwgkaib1P1gxX8HFszlD+7/gTfNvuAybgLPNis=\""
</VirtualHost>

# bug 1566155
<VirtualHost *:80>
    ServerName phonebook.mozilla.org

    ExpiresActive On
    ExpiresDefault "access plus 1 year"

    Redirect permanent / https://phonebook.mozilla.org/
</VirtualHost>
<VirtualHost *:81>
    ServerName phonebook.mozilla.org

    ExpiresActive On
    ExpiresDefault "access plus 1 year"

    Header always set Strict-Transport-Security "max-age=3600"


    RewriteEngine On

    # https://phonebook.mozilla.org/?search/usernamehere => https://people.mozilla.org/s?query=usernamehere&who=staff
    RewriteCond %{QUERY_STRING} "search/(.*)$"
    RewriteRule "^/" https://people.mozilla.org/s?query=%1&who=staff [L,NC,R=302,NE]

    # https://phonebook.mozilla.org/tree.php => https://people.mozilla.org/o
    RewriteRule "^/tree.php" https://people.mozilla.org/o [L,NC,R=302,QSA]

    # Redirect everything else to people.mozilla.org/
    RewriteRule "^/?(.*)" "https://people.mozilla.org/" [L,R=302]
</VirtualHost>

# Bug 1491411
<VirtualHost *:80>
    ServerName wildcard.start.mozilla.com
    ServerAlias *.start.mozilla.com *.start2.mozilla.com *.start3.mozilla.com *.start-prod.mozilla.com

    RewriteEngine On
    RewriteRule "^/?(.*)" "https://%{HTTP_HOST}/$1" [L,R=307,QSA]
</VirtualHost>
<VirtualHost *:81>
    ServerName wildcard.start.mozilla.com
    ServerAlias *.start.mozilla.com *.start2.mozilla.com *.start3.mozilla.com *.start-prod.mozilla.com

    ExpiresActive On
    ExpiresDefault "access plus 1 year"

    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{HTTP_HOST} ^([a-z]{2,3})(-[a-z]{2})?\.(start.*)$
    RewriteMap uppercase int:toupper
    RewriteRule ^ http://start.mozilla.org/%1${uppercase:%2}/? [R=301,L]
</VirtualHost>
<VirtualHost *:80>
    ServerName start.mozilla.com
    ServerAlias start-prod.mozilla.com

    RewriteEngine On
    RewriteRule "^/?(.*)" "https://%{HTTP_HOST}/$1" [L,R=307,QSA]
</VirtualHost>
<VirtualHost *:81>
    ServerName start.mozilla.com
    ServerAlias start-prod.mozilla.com

    ExpiresActive On
    ExpiresDefault "access plus 1 year"

    Redirect permanent / http://start.mozilla.org/
</VirtualHost>
